name: è§„åˆ™åˆå¹¶


on:
schedule:
- cron: "0 3 * * *"
workflow_dispatch:
inputs:
dry_run:
description: "ä»…æ‰§è¡Œæž„å»ºä¸Žç»Ÿè®¡ï¼Œä¸æäº¤ç»“æžœï¼ˆtrue/falseï¼‰"
required: false
default: "false"
force:
description: "å¿½ç•¥è§„åˆ™å˜åŒ–é˜ˆå€¼ï¼Œå¼ºåˆ¶é€šè¿‡ï¼ˆtrue/falseï¼‰"
required: false
default: "false"
log_level:
description: "æ—¥å¿—çº§åˆ«ï¼ˆinfo/debugï¼‰"
required: false
default: "info"


jobs:
build:
runs-on: ubuntu-latest


steps:
- name: Checkout dev branch
uses: actions/checkout@v4
with:
ref: dev


- name: Set up Python
uses: actions/setup-python@v5
with:
python-version: "3.x"


- name: Install dependencies
run: pip install requests pyyaml


- name: Show execution parameters
run: |
echo "ðŸ§­ Execution Parameters" >> $GITHUB_STEP_SUMMARY
echo "- Dry Run: ${{ github.event.inputs.dry_run || 'false' }}" >> $GITHUB_STEP_SUMMARY
echo "- Force Pass: ${{ github.event.inputs.force || 'false' }}" >> $GITHUB_STEP_SUMMARY
echo "- Log Level: ${{ github.event.inputs.log_level || 'info' }}" >> $GITHUB_STEP_SUMMARY


- name: Build rules
env:
DRY_RUN: ${{ github.event.inputs.dry_run }}
FORCE_PASS: ${{ github.event.inputs.force }}
LOG_LEVEL: ${{ github.event.inputs.log_level }}
run: python scripts/merge.py


- name: Upload stats summary
if: always()
run: |
echo "ðŸ“Š Build Statistics" >> $GITHUB_STEP_SUMMARY
if [ -f output/stats.json ]; then
cat output/stats.json >> $GITHUB_STEP_SUMMARY
else
echo "stats.json not found" >> $GITHUB_STEP_SUMMARY
fi


- name: Commit & Push
if: ${{ github.event.inputs.dry_run != 'true' }}
run: |
git config user.name "github-actions"
git config user.email "github-actions@github.com"
git add output/
git commit -m "auto: update rules" || exit 0
git push origin dev
